<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Edit Profil Admin Bagian</title>
    <link rel="icon" type="image/png" href="logo.png" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f1f8f4;
        margin: 0;
        padding: 0;
      }
      .admin-dashboard {
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 250px;
        height: 100vh;
        background: linear-gradient(180deg, #2e7d32 80%, #388e3c 100%);
        color: #fff;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        box-shadow: 2px 0 12px #0001;
        z-index: 10;
      }
      .sidebar-logo {
        font-size: 1.7rem;
        font-weight: bold;
        padding: 32px 0 24px 0;
        text-align: center;
        letter-spacing: 1px;
        border-bottom: 1px solid #388e3c44;
      }
      .sidebar-nav {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 24px;
        padding: 0 18px;
        flex: 1;
      }
      .nav-btn {
        background: none;
        border: none;
        color: #fff;
        font-size: 1.08rem;
        font-weight: 500;
        text-align: left;
        padding: 12px 18px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 14px;
        transition: background 0.18s, color 0.18s;
      }
      .nav-btn:hover,
      .nav-btn.active {
        background: #e8f5e9;
        color: #2e7d32;
      }
      .main-content {
        margin-left: 250px;
        flex: 1;
        padding: 36px 36px 36px 36px;
        min-width: 0;
        display: flex;
        flex-direction: column;
        gap: 32px;
      }
      .main-header {
        margin-bottom: 18px;
        border-bottom: 1px solid #c8e6c9;
        padding-bottom: 12px;
      }
      .main-header h1 {
        color: #2e7d32;
        font-size: 2rem;
        margin: 0;
        font-weight: 700;
        letter-spacing: 1px;
      }
      .admin-akun-section {
        background: #fff;
        border-radius: 0 12px 12px 0;
        box-shadow: 0 4px 16px #0001;
        padding: 32px 32px 24px 32px;
        margin-bottom: 0;
        max-width: unset;
        margin-left: 0;
        margin-right: 0;
        width: 100%;
        min-height: 400px;
      }
      .admin-akun-section h2 {
        color: #388e3c;
        font-size: 1.3rem;
        margin-bottom: 18px;
        font-weight: 600;
        text-align: left;
        padding-left: 2px;
      }
      label {
        color: #388e3c;
        font-weight: 500;
        margin-bottom: 4px;
        display: block;
        margin-top: 14px;
        font-size: 1.07rem;
      }
      input,
      select {
        width: 100%;
        margin-bottom: 12px;
        padding: 12px;
        border-radius: 7px;
        border: 1px solid #c8e6c9;
        font-size: 1.07rem;
        background: #f1f8f4;
        color: #1b5e20;
        transition: border 0.18s;
      }
      input:focus,
      select:focus {
        border: 1.5px solid #43a047;
        outline: none;
        background: #e8f5e9;
      }
      .btn {
        padding: 10px 22px;
        font-size: 1.07rem;
        border-radius: 7px;
        cursor: pointer;
        margin: 18px 8px 0 0;
        border: none;
        background: #43a047;
        color: #fff;
        font-weight: 600;
        transition: background 0.18s, box-shadow 0.18s;
        box-shadow: 0 2px 8px #388e3c22;
      }
      .btn:hover {
        background: #388e3c;
        box-shadow: 0 4px 16px #388e3c33;
      }
      .btn-cancel {
        background: #bdbdbd;
        color: #fff;
      }
      .btn-cancel:hover {
        background: #888;
      }
      .msg {
        margin-top: 12px;
        color: #2e7d32;
        font-size: 1.05rem;
        font-weight: 500;
        text-align: left;
        min-height: 24px;
        padding-left: 2px;
      }
      .msg.error {
        color: #d32f2f;
      }
      @media (max-width: 900px) {
        .sidebar {
          position: static;
          width: 100vw;
          height: 60px;
          min-height: unset;
          flex-direction: row;
        }
        .main-content {
          margin-left: 0;
          padding: 12px 2vw 12px 2vw;
        }
        .admin-akun-section {
          border-radius: 0 0 12px 12px;
          padding: 18px 6px 18px 6px;
        }
      }
    </style>
  </head>
  <body>
    <div class="admin-dashboard">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-logo">
          <span>Admin Loket</span>
        </div>
        <nav class="sidebar-nav">
          <button class="nav-btn" id="navDashboard">
            <i class="bi bi-speedometer2"></i> Dashboard
          </button>
          <button class="nav-btn active" id="navProfil">
            <i class="bi bi-person"></i> Profil
          </button>
          <button class="nav-btn" id="btnLogout">
            <i class="bi bi-box-arrow-right"></i> Logout
          </button>
        </nav>
      </aside>
      <main class="main-content">
        <header class="main-header">
          <h1>Edit Profil Admin Bagian</h1>
        </header>
        <section class="admin-akun-section">
          <h2>Form Edit Profil</h2>
          <form id="editProfileForm" autocomplete="off">
            <label for="profileNama">Nama</label>
            <input type="text" id="profileNama" required />

            <label for="profileLoket">Loket</label>
            <select id="profileLoket" required>
              <option value="H">Pojok E-Court</option>
              <option value="G">Pelayanan Informasi</option>
              <option value="E">Kasir</option>
              <option value="F">Pengambilan Produk</option>
              <option value="X">Posbakum</option>
            </select>

            <label for="profilePassword">Password Baru (opsional)</label>
            <input
              type="password"
              id="profilePassword"
              placeholder="Kosongkan jika tidak ingin ganti"
              autocomplete="new-password"
            />

            <div>
              <button type="submit" class="btn">Simpan</button>
              <button type="button" class="btn btn-cancel" id="cancelBtn">
                Batal
              </button>
            </div>
            <div class="msg" id="msg"></div>
          </form>
        </section>
      </main>
    </div>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        update,
        get,
      } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-database.js";

      import { db } from "./js/firebase-config.js"; // Ganti path sesuai lokasi file

      // Ambil data login dari localStorage
      const uid = localStorage.getItem("uid");
      const role = localStorage.getItem("role");
      if (!uid || role !== "bagian") window.location.href = "login.html";

      // Nama Loket
      const namaLoket = {
        H: "Pojok E-Court",
        G: "Pelayanan Informasi",
        E: "Kasir",
        F: "Pengambilan Produk",
        X: "Posbakum",
      };

      // Ambil data admin dari database
      let namaAdmin = "Admin";
      let loketAdmin = "H";
      try {
        const snap = await get(ref(db, `admins/${uid}`));
        if (!snap.exists()) {
          window.location.href = "login.html";
        }
        const data = snap.val();
        namaAdmin = data.nama || "Admin";
        loketAdmin = data.loket || "H";
        document.getElementById("profileNama").value = namaAdmin;
        document.getElementById("profileLoket").value = loketAdmin;
      } catch (err) {
        document.getElementById("msg").textContent =
          "Gagal mengambil data admin!";
        document.getElementById("msg").classList.add("error");
      }

      // Simpan perubahan profil
      document.getElementById("editProfileForm").onsubmit = async function (e) {
        e.preventDefault();
        const nama = document.getElementById("profileNama").value.trim();
        const loket = document.getElementById("profileLoket").value;
        const password = document.getElementById("profilePassword").value;
        const msg = document.getElementById("msg");
        msg.textContent = "";
        msg.classList.remove("error");

        if (!nama) {
          msg.textContent = "Nama tidak boleh kosong!";
          msg.classList.add("error");
          return;
        }

        const updateData = { nama, loket };
        if (password) updateData.password = password;

        try {
          await update(ref(db, `admins/${uid}`), updateData);
          // Update localStorage
          localStorage.setItem("nama", nama);
          localStorage.setItem("loket", loket);
          msg.textContent = "Profil berhasil diperbarui!";
          msg.classList.remove("error");
          setTimeout(() => {
            msg.textContent = "";
            window.location.href = "admin-bagian.html";
          }, 1200);
        } catch (err) {
          msg.textContent = "Gagal memperbarui profil!";
          msg.classList.add("error");
        }
      };

      document.getElementById("cancelBtn").onclick = function () {
        window.location.href = "admin-bagian.html";
      };

      // Sidebar Navigation
      document.getElementById("navDashboard").onclick = function () {
        window.location.href = "admin-bagian.html";
      };
      document.getElementById("navProfil").onclick = function () {
        // Sudah di halaman profil
      };
      document.getElementById("btnLogout").onclick = function () {
        localStorage.clear();
        window.location.href = "login.html";
      };
    </script>
  </body>
</html>
